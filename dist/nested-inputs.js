"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();!function(e){var t=function(){function t(e,n,i){_classCallCheck(this,t),this.wrapper=e,this.hostControl=n,this.settings=i,this.emptyNode={value:null},this._addNode(this.wrapper.find("ul"),this.settings.values||[this.emptyNode])}return _createClass(t,[{key:"_addNode",value:function(t){for(var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=function(a){var o=e("<input>",{value:i[a].value,class:"form-control input-sm"}),u=e("<li>",{html:[o,n._addSiblingButton(o),n._addChildButton(o),n._removeNodeButton(o),e("<ul>")]});o.on("keydown",function(e){13===e.keyCode&&(e.metaKey||e.ctrlKey?n._addChild(o):n._addSibling(o),e.preventDefault())}).on("change",function(){return n.onChange()}),u.appendTo(t),o.focus(),n._addNode(u.find("ul"),i[a].children)},o=0;o<i.length;o++)a(o)}},{key:"_addSibling",value:function(t){this._addNode(e(t).closest("ul"),[this.emptyNode])}},{key:"_addChild",value:function(t){this._addNode(e(t).next().next().next().next(),[this.emptyNode])}},{key:"_removeNode",value:function(t){e(t).closest("li").remove(),this.onChange()}},{key:"_addSiblingButton",value:function(e){var n=this;return t._addButton('<i class="fa fa-plus-circle"></i>',function(){return n._addSibling(e)})}},{key:"_addChildButton",value:function(e){var n=this;return t._addButton('<i class="fa fa-level-down"></i>',function(){return n._addChild(e)})}},{key:"_removeNodeButton",value:function(e){var n=this;return t._addButton('<i class="fa fa-minus-circle"></i>',function(){return n._removeNode(e)})}},{key:"onChange",value:function(){var e=this.toJson(this.wrapper),t=JSON.stringify(e);this.hostControl.val(t)}},{key:"toJson",value:function(e){var t=this.traverseNode(e).children;return t}},{key:"traverseNode",value:function(t){var n=this,i=e(t).find("> input").val(),a=[].map.call(e(t).children("ul").children("li"),function(e){return n.traverseNode(e)});return{value:i,children:a}}}],[{key:"_addButton",value:function(t,n){return e("<button>",{class:"btn btn-default btn-xs",type:"button",html:t,tabIndex:-1}).on("click",n)}}]),t}();e.fn.nestedInputs=function(n){var i={},a=e.extend({},i,n);this.each(function(n,i){if(i=e(i),"1"!==i.data("nested-inputs")){var o=e('\n                <div class="nested-inputs">\n                    <ul class="nested-inputs-root"></ul>\n                </div>');return i.after(o).hide().data("nested-inputs","1"),a.values=JSON.parse(i.val()||"[]"),new t(o,i,a)}})}}(jQuery);