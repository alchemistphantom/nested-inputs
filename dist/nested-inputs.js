"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(t){var e=function(){function e(t,n,i){_classCallCheck(this,e),this.wrapper=t,this.hostControl=n,this.settings=i,this.emptyNode={value:null},0==this.settings.values.length&&(this.settings.values=[this.emptyNode]),this._addNode(this.wrapper.find("ul"),this.settings.values)}return _createClass(e,[{key:"_addNode",value:function(e){for(var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=function(a){var u=t("<input>",{value:i[a].value,class:"form-control input-sm"}),o=t("<li>",{html:[u,n._addSiblingButton(u),n._addChildButton(u),n._removeNodeButton(u),t("<ul>")]});u.on("keydown",function(t){13===t.keyCode&&(t.metaKey||t.ctrlKey?n._addChild(u):n._addSibling(u),t.preventDefault())}).on("change",function(){return n.onChange()}),o.appendTo(e),u.focus(),n._addNode(o.find("ul"),i[a].children)},u=0;u<i.length;u++)a(u)}},{key:"_addSibling",value:function(e){this._addNode(t(e).closest("ul"),[this.emptyNode])}},{key:"_addChild",value:function(e){this._addNode(t(e).next().next().next().next(),[this.emptyNode])}},{key:"_removeNode",value:function(e){t(e).closest("li").remove(),this.onChange()}},{key:"_addSiblingButton",value:function(t){var n=this;return e._addButton('<i class="fa fa-plus-circle"></i>',function(){return n._addSibling(t)})}},{key:"_addChildButton",value:function(t){var n=this;return e._addButton('<i class="fa fa-level-down"></i>',function(){return n._addChild(t)})}},{key:"_removeNodeButton",value:function(t){var n=this;return e._addButton('<i class="fa fa-minus-circle"></i>',function(){return n._removeNode(t)})}},{key:"onChange",value:function(){var t=this.toJson(this.wrapper),e=JSON.stringify(t);this.hostControl.val(e)}},{key:"toJson",value:function(t){var e=this.traverseNode(t).children;return e}},{key:"traverseNode",value:function(e){var n=this,i=t(e).find("> input").val(),a=[].map.call(t(e).children("ul").children("li"),function(t){return n.traverseNode(t)});return{value:i,children:a}}}],[{key:"_addButton",value:function(e,n){return t("<button>",{class:"btn btn-default btn-xs",type:"button",html:e,tabIndex:-1}).on("click",n)}}]),e}();t.fn.nestedInputs=function(n){var i={},a=t.extend({},i,n);this.each(function(n,i){if(i=t(i),"1"!==i.data("nested-inputs")){var u=t('\n                <div class="nested-inputs">\n                    <ul class="nested-inputs-root"></ul>\n                </div>');return i.after(u).hide().data("nested-inputs","1"),a.values=JSON.parse(i.val()||"[]"),new e(u,i,a)}})}}(jQuery);